{% extends "base.html" %}
{% load static %}



{% block content %}
<section id="reviews" class="py-5">
    <div class="container">
        <div class="text-center mb-5">
            <h2 class="fw-bold">Отзывы наших клиентов</h2>
            <p class="text-muted">Что говорят о нас довольные клиенты</p>
            <a class="btn btn-primary ms-lg-3" href="{% url "reviews:add_review" %}">Оставить отзыв</a>
        </div>
        
        <div class="row">
            {% for review in reviews %}
                <div class="col-md-4">
                    <div class="testimonial-card">
                        <div class="d-flex align-items-center mb-3">
                            {% if review.user.image %}
                                <img src="{{ review.user.image.url }}" class="testimonial-img me-3" alt="Клиент">
                            {% else %}
                                <img src="{% static 'deps/images/bg-image.jpg' %}" class="testimonial-img me-3" alt="Клиент">
                            {% endif %}
                            <div>
                                <h5 class="mb-0">{{ review.user.username }}</h5>
                                <div class="text-warning">
                                    <!-- Заполненные звёзды -->
                                    {% for i in "12345"|make_list %}
                                        {% if forloop.counter <= review.stars %}
                                            <i class="fas fa-star"></i>
                                        {% else %}
                                            <i class="far fa-star"></i>
                                        {% endif %}
                                    {% endfor %}
                        
                                </div>
                            </div>
                        </div>
                        {# Ограничение длины комментария #}
                        {% if review.comment|length > 100 %}
                            <p class="mb-0">{{ review.comment|truncatechars:100 }}</p>
                            <a href="#" class="text-primary read-more" 
                            data-bs-toggle="modal" 
                            data-bs-target="#reviewModal{{ review.id }}">
                                Читать полностью
                            </a>
                        {% else %}
                            <p class="mb-0">{{ review.comment }}</p>
                        {% endif %}
                    </div>
                </div>
                {# Модальное окно для полного текста #}
                {% if review.comment|length > 100 %}
                <div class="modal fade" id="reviewModal{{ review.id }}" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                {% if review.user.image %}
                                    <img src="{{ review.user.image.url }}" class="testimonial-img me-3" alt="Клиент">
                                {% else %}
                                    <img src="{% static 'deps/images/bg-image.jpg' %}" class="testimonial-img me-3" alt="Клиент">
                                {% endif %}
                                <h5 class="modal-title">Отзыв от {{ review.user.username }}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                {{ review.comment }}
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary ms-lg-3" data-bs-dismiss="modal">Закрыть</button>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>
</section>
{% endblock content %}